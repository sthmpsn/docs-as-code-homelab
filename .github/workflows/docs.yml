name: Docs as Code Pipeline

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install Dependencies
        run: |
          pip install mkdocs mkdocs-material openapi-spec-validator

      - name: Install Vale
        uses: errata-ai/vale-action@v2
        with:
          version: '2.26.0' # pin stable version

      - name: Lint Markdown
        run: vale docs/

      - name: Validate OpenAPI
        run: openapi-spec-validator openapi.yaml

      - name: Build Documentation
        run: mkdocs build

# Optional deploy can stay commented until secrets are configured
#      - name: Deploy to Ubuntu Server
#        uses: appleboy/scp-action@v0.1.7
#        with:
#          host: ${{ secrets.SERVER_HOST }}
#          username: ${{ secrets.SERVER_USER }}
#          key: ${{ secrets.SERVER_SSH_KEY }}
#          source: "site/*"
#          target: "/var/www/docs"